<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Tutorials, recipes, and on-line resources" href="onlinereso.html" /><link rel="prev" title="Distributed execution" href="distributed.html" />

    <link rel="shortcut icon" href="_static/favicon-ipi.png"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.08.06 -->
        <title>A simple tutorial - i-PI documentation pages</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/custom_styles.css?v=78740f61" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">i-PI documentation pages</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/ipi-logo.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">i-PI documentation pages</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Program Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Core features</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Internal units and conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-files.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-tags.html">Input file tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-tags.html">Output file tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Tools and python utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">Distributed execution</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">A simple tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="onlinereso.html">Tutorials, recipes, and on-line resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="a-simple-tutorial">
<h1>A simple tutorial<a class="headerlink" href="#a-simple-tutorial" title="Permalink to this heading">¶</a></h1>
<p>Here we give a simple step-by-step guide through an example simulation,
exploring some of the more generally useful options that i-PI offers and
making no assumptions about previous experience with this code or other MD
codes. Excerpts from the relevant input files are reproduced here, for
explanation purposes, but to get the most out of this tutorial the user
is strongly encouraged to work through it themselves. For this purpose,
the input files have been included with the i-PI distribution, in the
“demos/para-h2-tutorial/” directory.</p>
<p>The chosen problem is that of a small <em>NVT</em> simulation of para-hydrogen,
using the Silvera-Goldman potential <span id="id1">[<a class="reference internal" href="bibliography.html#id1073"><span>SG78</span></a>]</span>.
We will take (<span class="math notranslate nohighlight">\(N\)</span>,<span class="math notranslate nohighlight">\(P\)</span>,<span class="math notranslate nohighlight">\(T\)</span>) = (108, 0, 25 K).</p>
<section id="part-1-nvt-equilibration-run">
<span id="part1"></span><h2>Part 1 - <em>NVT</em> Equilibration run<a class="headerlink" href="#part-1-nvt-equilibration-run" title="Permalink to this heading">¶</a></h2>
<p>In this tutorial, we consider the problem of how to use i-PI to run a <em>NVT</em>
simulation of para-hydrogen. The first thing that is required is a
client code that is capable of calculating the potential interactions of
para-hydrogen molecules. Fortunately, one of the client codes
distributed with i-PI has an appropriate empirical potential already
hard-coded into it, and so all that is required is to create the
“i-pi-driver” file compiling the code in the “drivers” directory, using
the UNIX utility make.</p>
<p>We will first go over the creation of the i-PI input file and afterwards
the commands of how to run i-PI and the client code.
If you want to skip the first section, against our recommendation if you are a newcomer
you can use the input file provided in the “tutorial-1” directory
and skip directly to <a class="reference internal" href="#run1"><span class="std std-ref">Running the simulation</span></a></p>
<p>This client code can be used for several different problems (see
<a class="reference internal" href="getting-started.html#driver-x"><span class="std std-ref">Built-in, fortran client</span></a>), some of which are explored in the “examples”
directory, but for the current problem we will use the Silvera-Goldman
potential with a cut-off radius of 15 Bohr.</p>
<section id="creating-the-xml-input-file">
<h3>Creating the xml input file<a class="headerlink" href="#creating-the-xml-input-file" title="Permalink to this heading">¶</a></h3>
<p>Now that the client code is ready, an appropriate xml input file needs
to be created from which the host server and the simulation data can be
initialized. Here, we will go step by step through the creation of a
minimal input file for a simple <em>NVT</em> equilibration run. Note that the
working final version is held within the “tutorial-1” directory for
reference.</p>
<p>Firstly, when reading the input file the i-PI xml functions look for a
<a class="reference internal" href="input-tags.html#simulation"><span class="std std-ref">simulation</span></a> tag as a sign to start reading data. For those familiar
with xml jargon, we have defined <a class="reference internal" href="input-tags.html#simulation"><span class="std std-ref">simulation</span></a> as the root tag, so all the input data
read in must start and end with a tag, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">simulation</span><span class="o">&gt;</span> <span class="n">Input</span> <span class="n">data</span> <span class="n">here</span><span class="o">...</span> <span class="o">&lt;/</span><span class="n">simulation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>xml syntax requires a set of hierarchically nested tags, each of which
contain data and/or more tags. Also, i-PI itself requires certain tags
to be present, and keeps track of which tags are supposed to be where.
More information about which tags are available can be found in
<a class="reference external" href="input-tags.html">input tags</a>, more information on xml syntax can be found in
<a class="reference internal" href="input-files.html#ifilestructure"><span class="std std-ref">Input file format and structure</span></a>, and possible errors which can occur if the
input file is not well-formed can be found in the
<a class="reference external" href="troubleshooting.html">troubleshooting section</a>.</p>
<p>For the sake of this first tutorial however, we will simply discuss
those tags which are needed for a single <em>NVT</em> equilibration run. The
most important tags are <a class="reference internal" href="input-tags.html#initialize"><span class="std std-ref">initialize</span></a>, <a class="reference internal" href="input-tags.html#ensemble"><span class="std std-ref">ensemble</span></a>, <a class="reference internal" href="input-tags.html#motion"><span class="std std-ref">motion</span></a>,
<a class="reference internal" href="input-tags.html#dynamics"><span class="std std-ref">dynamics</span></a>, “total_steps”, and <a class="reference internal" href="input-tags.html#forces"><span class="std std-ref">forces</span></a>. These correspond to
the tag to initialize the atom configurations (initialize), the tag
<em>ensemble</em> defines the properties of the statistical ensemble considered
(like temperature and pressure). While <em>motion</em> contains everything
regarding the motion of the atoms in general and allows to specify which
type of computation is expected (dynamics, geometry optimization, etc.),
the tag <em>dynamics</em> contains all the specifics relative to the molecular
dynamics (such as the barostat, thermostat and the time step, whose
total number is defined in the <em>total_step</em> tags.). In theory it would be
possible to join many different forces into the tag <em>forces</em>.
Each of the forces needs a force field socket (<em>ffsocket</em> tag)
that specify who is in charge of computing the forces and sending them
to i-PI. Note that the attribute “forcefield” of the <a class="reference internal" href="input-tags.html#force"><span class="std std-ref">force</span></a> tag must
correspond to the attribute “name” of one of the <a class="reference internal" href="input-tags.html#ffsocket"><span class="std std-ref">ffsocket</span></a> tag. All the
tags that define the actual simulation must be within the <a class="reference internal" href="input-tags.html#system"><span class="std std-ref">system</span></a> block.
We will also discuss <a class="reference internal" href="output-tags.html#outputs"><span class="std std-ref">Output file tags</span></a>, which is used to define what output data is
generated by the code.</p>
<p>After this short introduction, let’s get down to work.
We start with an input file that simply looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">simulation</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="o">&gt;</span>
   <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">simulation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and in the next subsections, we describe and show code snippets for all the other sections.</p>
<section id="initializing-the-configurations">
<h4>Initializing the configurations<a class="headerlink" href="#initializing-the-configurations" title="Permalink to this heading">¶</a></h4>
<p>First, we consider the <a class="reference internal" href="input-tags.html#initialize"><span class="std std-ref">initialize</span></a> tag within the <a class="reference internal" href="input-tags.html#system"><span class="std std-ref">system</span></a> block. As the name
suggests, this initializes the state of the system, so this is where we
will specify the atom positions and the cell parameters. Firstly, this
takes an attribute which specifies the number of replicas of the system,
called “nbeads”. An attribute is a particular type of xml syntax
designed to specify a single bit of data, and has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;initialize nbeads=’4’&gt; ... &lt;/initialize&gt;
</pre></div>
</div>
<p>Note that an attribute forms part of the opening tag, and that the value
being assigned to it is held within quotation marks. In this case, we
have set the number of replicas, or beads, to 4.
To run classical molecular dynamics, just set this value to one (nbeads=1).</p>
<p>Next, we must specify the atomic configuration. Rather than initialize
the atom positions manually, we will instead use a separate
configuration file for this purpose. Here we will discuss two of the
input formats that are compatible with i-PI: xyz files and pdb files.</p>
<p>Note that, for the sake of this tutorial, we have included valid xyz and
pdb input files in the “tutorial-1” directory called “our_ref.xyz” and
“our_ref.pdb”, respectively.</p>
<p>The xyz format is the simplest input format for a configuration file
that i-PI accepts, and has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">natoms</span>
<span class="c1"># CELL(abcABC): a b c A B C cell{angstrom} postions{angstrom}</span>
<span class="n">atom1</span> <span class="n">x1</span> <span class="n">y1</span> <span class="n">z1</span>
<span class="n">atom2</span> <span class="n">x2</span> <span class="n">y2</span> <span class="n">z2</span>
<span class="o">...</span>
</pre></div>
</div>
<p>where “natoms” is replaced by an integer giving the total number of
atoms, in this case 108, atom1 is a label for atom 1, in this case H2
(since we are simulating para-hydrogen), and (x1, y1, z1) are the x, y
and z components of atom 1 respectively. The second line is the comment line,
and can also contain  the cell parameters (a,b, and c are the lattice vectors, and A, B,C the angles)
In the example above we use the syntax “cell{angstrom}” and “postions{angstrom}”
to indicate the cell parameters and the position coordinates are provided in angstroms.</p>
<p>Note that we are treating the para-hydrogen molecules isotropically
here, i.e. as spherical psuedo-atoms. For the current system this is a
good approximation, since at the state point under consideration every
molecule is in its rotational ground state. For further details on this
potential, and a demonstration of its application to quantum dynamics,
see <span id="id2">[<a class="reference internal" href="bibliography.html#id1073"><span>SG78</span></a>]</span> and
<span id="id3">[<a class="reference internal" href="bibliography.html#id803"><span>MM05</span></a>]</span>.</p>
<p>Other than its simplicity, the main advantage of this type of file is
that it is free-formatted, and so there is no set precision to which
each value must be written. This greatly simplifies both reading and
writing these files.</p>
<p>The other file format that we can use is the pdb format. This has the
following structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TITLE</span> <span class="o">&lt;</span><span class="n">insert</span> <span class="n">title</span> <span class="n">here</span><span class="o">&gt;</span> <span class="n">position</span><span class="p">{</span><span class="n">angstrom</span><span class="p">}</span> <span class="n">cell</span><span class="p">{</span><span class="n">angstrom</span><span class="p">}</span>
<span class="n">CRYST1</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span>  <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">P</span> <span class="mi">1</span> <span class="mi">1</span>
<span class="n">ATOM</span> <span class="mi">1</span> <span class="n">atom1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">x1</span> <span class="n">y1</span> <span class="n">z1</span> <span class="mf">0.00</span> <span class="mf">0.00</span> <span class="mi">0</span>
<span class="n">ATOM</span> <span class="mi">2</span> <span class="n">atom2</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">x2</span> <span class="n">y2</span> <span class="n">z2</span> <span class="mf">0.00</span> <span class="mf">0.00</span> <span class="mi">0</span>
<span class="o">...</span>
</pre></div>
</div>
<p>where a, b and c are the cell vector lengths, A, B and C are the angles
between them, atom1 and atom2 are the labels for atoms 1 and 2, and (x1, y1,
z1) and (x2, y2, z2) give the position vectors of atoms 1 and 2.</p>
<p>Note that this is fixed-formatted, so the number of spaces matters.
Essentially, the above format needs to be copied verbatim, using the
same column widths and all the same keywords. For an exact specification
of the file format (of which only a subset is implemented with i-PI) see
<a class="reference external" href="https://www.wwpdb.org/documentation/file-format">https://www.wwpdb.org/documentation/file-format</a></p>
<p>Here we will show how to specify the xml input file in both of these
cases, assuming that the user has already created the configuration file
themselves. Note that these file formats can be read by visualization
programs such as VMD, and so it is generally advised when making your
own input files to use such software to make sure that the configuration
is as expected.</p>
<p>To use a configuration file the <a class="reference internal" href="input-tags.html#file"><span class="std std-ref">file</span></a> tag in  <a class="reference internal" href="input-tags.html#initialize"><span class="std std-ref">initialize</span></a> should be used. This will take an
input file with a given name and use it to initialize all relevant data.
Both of these formats have the atom positions and labels, so this will
initialize the positions, labels and masses of all the particles in the
system, with the masses being implicitly set based on the atom label.
The pdb configuration file will also be used to set the cell parameters.</p>
<p>Let us take these two file types in turn, and form the appropriate input
sections. First, the xyz file. There are two attributes which are
relevant to the <a class="reference internal" href="input-tags.html#file"><span class="std std-ref">file</span></a> tag for our current problem, “mode” and “units”. “mode”
is used to describe what kind of data is being used to initialize from,
and so in this case will be “xyz”. “units” specifies which units the
file is given in, and so in this case is given by “angstrom”, which are
the standard units of both xyz and pdb files. Note that if no units are
specified then atomic units are assumed. For more information on the
i-PI unit conversion libraries, and the available units, see
<a class="reference internal" href="input-files.html#inputunits"><span class="std std-ref">Overriding default units</span></a>.</p>
<p>The “units” attribute is now deprecated and will be removed in the
future version of i-PI. The alternative, and the only one available in
the future, is to specify the units within the comment line of the xyz
or the TITLE line of the pdb formats (as shown in the examples above).
It is also important to put the units only in one place: if the units
are present in both, the configuration file with the tag “units” and
in the input files (xyz or pdb) the conversion will be applied twice.</p>
</section>
<section id="a-further-comment-on-the-cell-units-and-parameters">
<h4>A further comment on the cell units and  parameters<a class="headerlink" href="#a-further-comment-on-the-cell-units-and-parameters" title="Permalink to this heading">¶</a></h4>
<p>It is important to note that the units of the cell parameters and the
units of the content of the files are specified separately
(“positionunits” specify the units of the data and “cellunits” specify
the units of the cell). This is necessary because the xyz format can be
used to also store quantities which have a different dimension than length
(velocities, forces, etc.). Even the cell parameters can now be
specified directly within the xyz format. The comment line is parsed
looking for a cell specification in the following format:</p>
<ul class="simple">
<li><p>“CELL{abcABC}:” followed by six float numbers.</p></li>
<li><p>“CELL{H}:” followed by nine float numbers.</p></li>
<li><p>“CELL{GENH}:” followed by nine float numbers.</p></li>
</ul>
<p>The “CELL{abcABC}” must be followed by the length of the vector cell and
the three angles between them (as in the CRYST1 field of the pdb format
-see above-). The other two must be followed by nine floats specifying,
respectively, all the values of the cell matrix (flattened) or all the
value of the inverse of the cell matrix (flattened).</p>
<p>Since the units are already specified into the xyz and pdb files, the
config file will contain:</p>
<p>If the cell parameters are not specified in the xyz file, then, in the
configuration file we must specify them separately. To initialize just
the cell parameters, we use the <a class="reference internal" href="input-tags.html#cell"><span class="std std-ref">cell</span></a> tag. These could in theory be set using
a separate file, but here we will initialize them manually. Taking a
cubic cell with cell parameter 17.847 angstroms, we can specify this
using the <a class="reference internal" href="input-tags.html#cell"><span class="std std-ref">cell</span></a> tag in three different ways:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;cell mode=’manual’ units=’angstrom’&gt; [17.847, 0, 0, 0, 17.847, 0, 0,
0, 17.847] &lt;/cell&gt;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;cell mode=’abcABC’ units=’angstrom’&gt; [17.847, 17.847, 17.847, 90,
90, 90] &lt;/cell&gt;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;cell mode=’abc’ units=’angstrom’&gt; [17.847, 17.847, 17.847] &lt;/cell&gt;
</pre></div>
</div>
<p>If the xyz already contains the cell parameters, i-PI will use those
which are read the last in the config file (if the “cell” tag follows
the “file” specification then the cell parameters are those defined in
the “cell” tag. If, otherwise, the “cell” tag compares in the config
file before the “file” specification, then the cell parameters of the
xyz file are used).</p>
<p>Note the use of the different “mode” attributes, “manual”, “abcABC” and
“abc”. The first creates the cell vector matrix manually, the second
takes the length of the three unit vectors and the angles between them
in degrees, and the last assumes an orthorhombic cell and so only takes
the length of the three unit vectors as arguments. We will take the last
version for brevity, giving as our final <a class="reference internal" href="input-tags.html#initialize"><span class="std std-ref">initialize</span></a> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;xyz&#39;</span><span class="o">&gt;</span> <span class="n">our_ref</span><span class="o">.</span><span class="n">xyz</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">cell</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;abc&#39;</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="o">&gt;</span>
      <span class="p">[</span><span class="mf">17.847</span><span class="p">,</span> <span class="mf">17.847</span><span class="p">,</span> <span class="mf">17.847</span><span class="p">]</span>
    <span class="o">&lt;/</span><span class="n">cell</span><span class="o">&gt;</span>
    <span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The pdb file is specified in a similar way, except that no <a class="reference internal" href="input-tags.html#cell"><span class="std std-ref">cell</span></a> tag needs to be
specified and the “mode” tag should be set to “pdb” (the units should be
specified into the pdb file as shown in the example above):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span><span class="o">&gt;</span> <span class="n">our_ref</span><span class="o">.</span><span class="n">pdb</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
     <span class="o">...</span>
   <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>As well as initializing all the atom positions, this section can also be
used to set the atom velocities. Rather than setting these manually, it
is usually simpler to sample these randomly from a Maxwell-Boltzmann
distribution. This can be done using the <a class="reference internal" href="input-tags.html#velocities"><span class="std std-ref">velocities</span></a> tag by setting the “mode”
attribute to “thermal”. This then takes an argument specifying the
temperature to initialize the velocities. With this, the final
<a class="reference internal" href="input-tags.html#initialize"><span class="std std-ref">initialize</span></a> section is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span><span class="o">&gt;</span> <span class="n">our_ref</span><span class="o">.</span><span class="n">pdb</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">velocities</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">velocities</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="generating-the-correct-dynamics">
<h4>Generating the correct dynamics<a class="headerlink" href="#generating-the-correct-dynamics" title="Permalink to this heading">¶</a></h4>
<p>We continue within the <a class="reference internal" href="input-tags.html#system"><span class="std std-ref">system</span></a> block  and consider the <a class="reference internal" href="input-tags.html#motion"><span class="std std-ref">motion</span></a> tag, which determines the computation
i-pi will perform. Since we wish to run molecular dynamics, the
attribute “mode” of the “motion” tag must be equal to “dynamics”. The
details of the dynamics integration are given within <a class="reference internal" href="input-tags.html#dynamics"><span class="std std-ref">dynamics</span></a>. Since we wish to
do a <em>NVT</em> simulation, we set the “mode” attribute to “nvt” (note that
we use lower case, and that the tags are case sensitive), and must
specify the temperature using the appropriate tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;system&gt;
  ...
  &lt;motion mode=’dynamics’&gt;
    &lt;dynamics mode=’nvt’&gt; ... &lt;/dynamics&gt;
  &lt;/motion&gt;
&lt;/system&gt;
</pre></div>
</div>
<p>This defines the computation that will be performed. We also must decide
which integration algorithm to use, and how large the time step should
be. In general, the time step should be made as large as possible
without there being a drift in the conserved quantity. Usually, we would
take a few short runs with different time steps to try and optimize
this, but for the sake of this tutorial we will use a safe value of 1
femtosecond, giving:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;system&gt;
  ...
  &lt;dynamics mode=’nvt’&gt;
       ...
       &lt;timestep units=’femtosecond’&gt; 1 &lt;/timestep&gt;
  &lt;/dynamics&gt;
&lt;/system&gt;
</pre></div>
</div>
<p>Finally, while the microcanonical part of the integrator is initialized
automatically, there are several different options for the constant
temperature sampling algorithm, specified by <a class="reference internal" href="input-tags.html#thermostat"><span class="std std-ref">thermostat</span></a>. For simplicity we will
use (the global version of) the path-integral Langevin equation (PILE)
algorithm <span id="id4">[<a class="reference internal" href="bibliography.html#id200"><span>CPMM10</span></a>]</span>, which is specifically designed
for path integral simulations. This is specified by the “mode” tag
“pile_g”. This integrator also has to be initialized with a time scale
parameter, “tau”, which determines how strong the thermostat is, which
we will set to 25 femtoseconds. Putting all of this together, we get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
  <span class="o">...</span>
 <span class="o">&lt;</span><span class="n">dynamics</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nvt&#39;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">thermostat</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pile_g&#39;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">tau</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">tau</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">thermostat</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">timestep</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;/</span><span class="n">timestep</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">dynamics</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Now that we have decided on the time step, we will decide the total
number of steps to run the simulation for. Equilibrating the system is
likely to take around 5 picoseconds, so we will take 5000 time steps,
using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">total_steps</span><span class="o">&gt;</span> <span class="mi">5000</span> <span class="o">&lt;/</span><span class="n">total_steps</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The temperature must be specified within the <a class="reference internal" href="input-tags.html#ensemble"><span class="std std-ref">ensemble</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;system&gt;
    ...
    &lt;ensemble&gt;
        &lt;temperature units=’kelvin’&gt; 300 &lt;/temperature&gt;
    &lt;/ensemble&gt;
    ...
&lt;/system&gt;
</pre></div>
</div>
<p>To recap, at this point the input file looks as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">simulation</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">total_steps</span><span class="o">&gt;</span> <span class="mi">5000</span> <span class="o">&lt;/</span><span class="n">total_steps</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span><span class="o">&gt;</span> <span class="n">our_ref</span><span class="o">.</span><span class="n">pdb</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">velocities</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">velocities</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">motion</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamics&#39;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">dynamics</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nvt&#39;</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">thermostat</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pile_g&#39;</span><span class="o">&gt;</span>
           <span class="o">&lt;</span><span class="n">tau</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">tau</span><span class="o">&gt;</span>
         <span class="o">&lt;/</span><span class="n">thermostat</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">timestep</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;/</span><span class="n">timestep</span><span class="o">&gt;</span>
       <span class="o">&lt;/</span><span class="n">dynamics</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">motion</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">ensemble</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">temperature</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">temperature</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ensemble</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">simulation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Please make sure you understand all the lines in the input file before continuing.</p>
</section>
<section id="defining-the-forces">
<h4>Defining the forces<a class="headerlink" href="#defining-the-forces" title="Permalink to this heading">¶</a></h4>
<p>We continue within the the <a class="reference internal" href="input-tags.html#system"><span class="std std-ref">system</span></a> block, and now consider the <a class="reference internal" href="input-tags.html#forces"><span class="std std-ref">forces</span></a> tag that defines each of
(the possibly many) components of the forces.
Within this tag, the user can specify many different “force” tags and the
final force will be the sum of the contribution from each “force” tag.
In this simple example, however, we consider only one force component, and the corresponding section of the input
reads</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
  <span class="o">...</span>
  <span class="o">&lt;</span><span class="n">forces</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">force</span> <span class="n">forcefield</span><span class="o">=</span><span class="s1">&#39;driver&#39;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">force</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">forces</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The attribute “forcefield” of the tag <em>force</em> is simply a label that allows i-PI to match
that particular force component with the corresponding server socket.
Note that this apparent unnecessary-complicated syntax makes possible complex setups
required by more advanced simulations.</p>
</section>
<section id="creating-the-server-socket">
<h4>Creating the server socket<a class="headerlink" href="#creating-the-server-socket" title="Permalink to this heading">¶</a></h4>
<p>Next let us consider the <a class="reference internal" href="input-tags.html#ffsocket"><span class="std std-ref">ffsocket</span></a>  which deals with
communication with the client codes. In this example,
we only need to specify a single <a class="reference internal" href="input-tags.html#ffsocket"><span class="std std-ref">ffsocket</span></a> tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ffsocket</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;/</span><span class="n">ffsocket</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>A socket is specified with three parameters; the port number, the
hostname and whether it is a unix or an internet socket. These are
specified by the “port” and “address” tags and the “mode” attribute
respectively. To match up with the client socket specified above, we
will take an internet socket on the hostname localhost and use port
number 31415.</p>
<p>This gives the final <a class="reference internal" href="input-tags.html#ffsocket"><span class="std std-ref">ffsocket</span></a> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ffsocket</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;inet&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;driver&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span> <span class="n">localhost</span> <span class="o">&lt;/</span><span class="n">address</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span> <span class="mi">31415</span> <span class="o">&lt;/</span><span class="n">port</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ffsocket</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and by adding it to the previous sections we have</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">simulation</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">total_steps</span><span class="o">&gt;</span> <span class="mi">5000</span> <span class="o">&lt;/</span><span class="n">total_steps</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">ffsocket</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;inet&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;driver&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span> <span class="n">localhost</span> <span class="o">&lt;/</span><span class="n">address</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span> <span class="mi">31415</span> <span class="o">&lt;/</span><span class="n">port</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ffsocket</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span><span class="o">&gt;</span> <span class="n">our_ref</span><span class="o">.</span><span class="n">pdb</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">velocities</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">velocities</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">motion</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamics&#39;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">dynamics</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nvt&#39;</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">thermostat</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pile_g&#39;</span><span class="o">&gt;</span>
           <span class="o">&lt;</span><span class="n">tau</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">tau</span><span class="o">&gt;</span>
         <span class="o">&lt;/</span><span class="n">thermostat</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">timestep</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;/</span><span class="n">timestep</span><span class="o">&gt;</span>
       <span class="o">&lt;/</span><span class="n">dynamics</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">motion</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">ensemble</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">temperature</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">temperature</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ensemble</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">simulation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that the <a class="reference internal" href="input-tags.html#ffsocket"><span class="std std-ref">ffsocket</span></a> section lives outside the <a class="reference internal" href="input-tags.html#system"><span class="std std-ref">system</span></a> block.</p>
</section>
<section id="customizing-the-output">
<h4>Customizing the output<a class="headerlink" href="#customizing-the-output" title="Permalink to this heading">¶</a></h4>
<p>So far, we have only considered how to set up the simulation, and not
the data we wish to obtain from it. However, there are a wide variety of
properties of interest that i-PI can calculate and a large number of
different output options, so to avoid confusion let us go through them
one at a time.</p>
<p>First, we have the standard output. For this output, the amount of data can be adjusted with
the “verbosity” attribute of <a class="reference internal" href="input-tags.html#simulation"><span class="std std-ref">simulation</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;simulation verbosity=’high’&gt; ... &lt;/simulation&gt;
</pre></div>
</div>
<p>By default the verbosity is set to “low”, which only outputs important
warning messages and information, and some statistical information every
1000 time steps. Here we will set it to “high”, which will tell i-PI to
output the wall time required for the last step at  each step and information
related to the socket communication.</p>
<p>Second, we have output written to file(s). The content of such output(s)  is specified by the <a class="reference internal" href="input-tags.html#output"><span class="std std-ref">output</span></a> tag. There are
three types of files; properties files, trajectory files and checkpoint
files, which are specified with <a class="reference internal" href="input-tags.html#properties"><span class="std std-ref">properties</span></a>, <a class="reference internal" href="input-tags.html#trajectory"><span class="std std-ref">trajectory</span></a> and <a class="reference internal" href="input-tags.html#checkpoint"><span class="std std-ref">checkpoint</span></a>
tags respectively. For an in-depth
discussion on these three types of output files see
<a class="reference internal" href="output-files.html#outputfiles"><span class="std std-ref">Output files</span></a>, but for now let us just explain the rationale
behind each of these output file types in turn.</p>
<dl class="simple">
<dt>checkpoint files:</dt><dd><p>These give a snapshot of the state of the simulation. If used as an
input file for a new i-PI simulation, this simulation will start from
the point where the checkpoint file was created in the old
simulation.</p>
</dd>
<dt>trajectory files:</dt><dd><p>These are used to print out properties relevant to all the atoms,
such as the velocities or forces, for each degree of freedom. These
can be useful for calculating correlation functions or radial
distribution functions, but possibly their most useful feature is
that visualization programs such as VMD can read them, and then use
this data to show a movie of how the simulation is progressing.</p>
</dd>
<dt>properties files:</dt><dd><p>These are usually used to print out system level properties, such as
the timestep, temperature, or kinetic energy. Essentially these are
used to keep track of a small number of important properties, either
to visualize the progress of the simulation using plotting programs
such as gnuplot, or to be used to get ensemble averages.</p>
</dd>
</dl>
<p>Now that we know what each input file is used for, let’s analyze the  <a class="reference internal" href="input-tags.html#output"><span class="std std-ref">output</span></a> section
as provided in “tutorial-1/tutorial-1.xml” which reads</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">output</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;tut1&#39;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">checkpoint</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;checkpoint&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;1000&#39;</span> <span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">checkpoint</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">properties</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;md&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">&gt;</span>
      <span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="n">time</span><span class="p">{</span><span class="n">picosecond</span><span class="p">},</span> <span class="n">conserved</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">temperature</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span>
       <span class="n">potential</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">kinetic_cv</span><span class="p">{</span><span class="n">kelvin</span><span class="p">}]</span>
  <span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">trajectory</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;100&#39;</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span> <span class="n">cell_units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="o">&gt;</span>
           <span class="n">positions</span><span class="p">{</span><span class="n">angstrom</span><span class="p">}</span>
  <span class="o">&lt;/</span><span class="n">trajectory</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">trajectory</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;forces&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="o">&gt;</span> <span class="n">forces</span>  <span class="o">&lt;/</span><span class="n">trajectory</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">output</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This setup will create 11 files:</p>
<p><em>checkpoint file:</em> “tut1.checkpoint”</p>
<p><em>properties file:</em> “tut1.md”</p>
<p><em>position trajectory files (1 file per bead):</em> “tut1.pos_0.pdb”, “tut1.pos_1.pdb”, “tut1.pos_2.pdb”, and “tut1.pos_3.pdb”</p>
<p><em>forces trajectory files (1 file per bead):</em> “tut1.forces_0.xyz”, “tut1.forces_2.xyz”, “tut1.forces_1.xyz”, and “tut1.forces_3.xyz”</p>
<p>The filenames are created using the syntax “prefix”.“filename”[_(file
specifier)][.(file format)], where the file specifier is added to
separate similar files. For example, in the above case the different
position trajectories for each bead are given a file specifier
corresponding to the appropriate bead index.</p>
<p>The “stride” attribute sets how often data is output to each file; so in
the above case the properties are written out every 10 time steps, the
trajectories every 100, and the checkpoints every 1000. The “format”
attribute sets the format of the trajectory files, and the “overwrite”
attribute sets whether each checkpoint file overwrites the previous one
or not.</p>
<p>There are several options we can use to customize the output data.
Firstly, the “prefix” attribute should be set to something which can be
used to distinguish the files from different simulation runs. In the previous snippet
we set it to “tut1”:</p>
<p>As for the input parameters, the default units are always  atomic units.
However, this  can be modified by the user  by
specifying an appropriate unit in curly braces after the name of the
property or trajectory of interest. In the previous snippet, we have for
example set the temperature units to kelvin and position coordinates to angstroms</p>
<p>When using ‘pdb’ format, it is important to add the “cell_units” attribute to the <a class="reference internal" href="input-tags.html#trajectory"><span class="std std-ref">trajectory</span></a>
tag, so that the cell parameters are consistent with the position output.</p>
<p>Finally, let us suppose that we wished to output another output property
to a different file. One example of when this might be
necessary is if there were an output property which was more expensive
to calculate than the others, and so it would be impractical to output
at every time step. With i-PI this is easy to do, all that is required
is to add another <a class="reference internal" href="input-tags.html#properties"><span class="std std-ref">properties</span></a> tag with a different filename.</p>
<p>For demonstration purposes, we will choose to print out the forces
acting on one tagged bead, since this requires an argument to be passed
to the function that calculates it. The i-PI syntax for doing this is to
have the arguments to be passed to the function between standard braces,
separated by semi-colons.</p>
<p>To print out the forces acting on one bead we need the “atom_f”
property, which takes two arguments, “atom” and “bead”, giving the index
of the atom and bead tagged respectively. The appropriate syntax is then
given below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">output</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;tut1&#39;</span><span class="o">&gt;</span>
  <span class="o">...</span>
  <span class="o">&lt;</span><span class="n">properties</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;force&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">atom_f</span><span class="p">{</span><span class="n">piconewton</span><span class="p">}(</span><span class="n">atom</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">bead</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">output</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This will print out the force vector acting on bead 0 of atom 0.</p>
</section>
<section id="input-file-tutorial-1">
<h4>Input file tutorial-1<a class="headerlink" href="#input-file-tutorial-1" title="Permalink to this heading">¶</a></h4>
<p>If you reached this point, you have been able to specify the input file from scratch, well done!
Hopefully, this has helped you to understand the most important syntaxes of the i-PI input file.  However,
we recommend that next time you use one of the many input files provided within the “examples”
and “demos” folder.</p>
<p>For the sake of completeness, we copy the input file we have just created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">simulation</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">output</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;tut1&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">checkpoint</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;checkpoint&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;1000&#39;</span> <span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">checkpoint</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">properties</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;md&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">&gt;</span>
        <span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="n">time</span><span class="p">{</span><span class="n">picosecond</span><span class="p">},</span> <span class="n">conserved</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">temperature</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span>
         <span class="n">potential</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">kinetic_cv</span><span class="p">{</span><span class="n">kelvin</span><span class="p">}]</span>
    <span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">trajectory</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;100&#39;</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span> <span class="n">cell_units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="o">&gt;</span>
             <span class="n">positions</span><span class="p">{</span><span class="n">angstrom</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">trajectory</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">trajectory</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;forces&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="o">&gt;</span> <span class="n">forces</span>  <span class="o">&lt;/</span><span class="n">trajectory</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">properties</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;force&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">atom_f</span><span class="p">{</span><span class="n">piconewton</span><span class="p">}(</span><span class="n">atom</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">bead</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">output</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">total_steps</span><span class="o">&gt;</span> <span class="mi">5000</span> <span class="o">&lt;/</span><span class="n">total_steps</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ffsocket</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inet&#39;</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;driver&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span><span class="n">localhost</span><span class="o">&lt;/</span><span class="n">address</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span> <span class="mi">31415</span> <span class="o">&lt;/</span><span class="n">port</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ffsocket</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span><span class="o">&gt;</span> <span class="n">our_ref</span><span class="o">.</span><span class="n">pdb</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">velocities</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">velocities</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">forces</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">force</span> <span class="n">forcefield</span><span class="o">=</span><span class="s1">&#39;driver&#39;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">force</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">forces</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ensemble</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">temperature</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kelvin&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">temperature</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">ensemble</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">motion</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamics&#39;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">dynamics</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nvt&#39;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">thermostat</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pile_g&#39;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">tau</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">25</span> <span class="o">&lt;/</span><span class="n">tau</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">thermostat</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">timestep</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;femtosecond&#39;</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;/</span><span class="n">timestep</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">dynamics</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">motion</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">simulation</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="running-the-simulation">
<span id="run1"></span><h3>Running the simulation<a class="headerlink" href="#running-the-simulation" title="Permalink to this heading">¶</a></h3>
<p>If you haven’t already, please check out the <a class="reference internal" href="getting-started.html#install"><span class="std std-ref">Installing i-PI</span></a> section of this documentation to set up i-PI.</p>
<p>In the following, we assume that you are in the “demos/para-h2-tutorial/tutorial-1” folder.
Now that we have a valid input file, we can run the first part of the tutorial   using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">i</span><span class="o">-</span><span class="n">pi</span> <span class="n">tutorial</span><span class="o">-</span><span class="mf">1.</span><span class="n">xml</span>
</pre></div>
</div>
<p>This will start the i-PI simulation, creating the server socket and
initializing the simulation data. This should at this point print out a
header message to standard output, followed by a few information
messages that end with “starting the polling thread main loop”, which
signifies that the server socket has been opened and is waiting for
connections from client codes.</p>
<p>At this point, the driver code is run in a new terminal from the
“drivers” directory using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">i</span><span class="o">-</span><span class="n">pi</span><span class="o">-</span><span class="n">driver</span> <span class="o">-</span><span class="n">m</span> <span class="n">sg</span> <span class="o">-</span><span class="n">a</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">o</span> <span class="mi">15</span> <span class="o">-</span><span class="n">p</span> <span class="mi">31415</span>
</pre></div>
</div>
<p>The option “-m” is followed by the empirical potential required, in this
case we use “sg” for Silvera-Goldman, “-a localhost” sets up the client
hostname (address) as “localhost”, “-o 15” sets the cut-off to 15 Bohr, and
“-p 31415” sets the port number to 31415.</p>
<p>The i-PI code should now output a message saying that a new client code
has connected, and started running the simulation.</p>
</section>
<section id="output-data">
<h3>Output data<a class="headerlink" href="#output-data" title="Permalink to this heading">¶</a></h3>
<p>Once the simulation is finished (which should take about half an hour)
it should have output “tut1.md”, “tut1.force”, “tut1.pos_0.xyz”,
“tut1.pos_1.xyz”, “tut1.pos_2.xyz”, “tut1.pos_3.xyz”, “tut1.checkpoint”,
“tut1.forces_1.xyz”, “tut1.forces_2.xyz”, “tut1.forces_3.xyz”, “tut1.forces_4.xyz”,
and “RESTART”.</p>
<p>Firstly, we consider the checkpoint files, “tut1.checkpoint” and
“RESTART”. As mentioned before, these files can be used as a means of
restarting the simulation from a previous point. As an example, the last
checkpoint should have been at step 4999, and so we could rerun the last
step using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">i</span><span class="o">-</span><span class="n">pi</span> <span class="n">tut1</span><span class="o">.</span><span class="n">checkpoint</span>
</pre></div>
</div>
<p>followed by running “i-pi-driver” as before.</p>
<p>The difference between these two files is that, while “tut1.checkpoint”
was specified by the user, “RESTART” is automatically generated at the
end of every i-PI run. This file then is what we will need to initialize
the <em>NPT</em> run, since it contains the state of the system after
equilibration.</p>
<p>Next, let us look at the trajectory files. Since we have printed out the
positions, these should tell us how the spatial distribution has
equilibrated, and give us some insight into the atom dynamics. The
easiest way to use these files, as discussed earlier, is to use the
trajectory files as input to a visualization program such as VMD.</p>
<p>If we do this with these files, we see that the simulation started from
a crystalline configuration and then over the course of the simulation
began to melt. Since the state point considered here with the potential
given is a liquid <span id="id5">[<a class="reference internal" href="bibliography.html#id1073"><span>SG78</span></a>]</span>, this
is what we would expect.</p>
<p>Finally, let us check the “tut1.md” file. For the current problem, i.e.
checking that we have a suitably equilibrated system, we should do two
tests. Firstly, we should check that the conserved quantity does not
exhibit any major drift, and second we should check to see if the
properties of interest have converged. Using gnuplot, we can plot the
relevant graphs using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">gnuplot</span> <span class="o">-</span><span class="n">persist</span>  <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;plot &#39;tut1.md&#39; u 1:3&quot;</span> <span class="c1"># step vs conserved quantity</span>
<span class="o">&gt;</span> <span class="n">gnuplot</span> <span class="o">-</span><span class="n">persist</span>  <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;plot &#39;tut1.md&#39; u 1:4&quot;</span> <span class="c1"># step vs temperature</span>
<span class="o">&gt;</span> <span class="n">gnuplot</span> <span class="o">-</span><span class="n">persist</span>  <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;plot &#39;tut1.md&#39; u 1:5&quot;</span> <span class="c1"># step vs potential energy</span>
<span class="o">&gt;</span> <span class="n">gnuplot</span> <span class="o">-</span><span class="n">persist</span>  <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;plot &#39;tut1.md&#39; u 1:6&quot;</span> <span class="c1"># step vs kinetic  energy</span>
</pre></div>
</div>
<p>This will show that the conserved quantity has only a small drift
upwards, the kinetic and potential energies have equilibrated, and the
thermostat is keeping the temperature at the specified value. We have
therefore specified a sufficiently short time step, chosen the
thermostat parameters sensibly, and have equilibrated the properties of
interest. Therefore this stage of the simulation is done, and we are
ready to continue with the second part and start the <em>NPT</em> run.</p>
</section>
</section>
<section id="part-2-npt-simulation">
<span id="part2"></span><h2>Part 2 - <em>NPT</em> simulation<a class="headerlink" href="#part-2-npt-simulation" title="Permalink to this heading">¶</a></h2>
<p>Now that we have converged <em>NVT</em> simulation data, we can use this to
initialize a <em>NPT</em> simulation. There are two ways of doing this, both of
which involve using the RESTART file generated at the end of the <em>NVT</em>
run as a starting point. Note that for simplicity we will again take
<span class="math notranslate nohighlight">\(N=108, T=25 K\)</span>, and use <span class="math notranslate nohighlight">\(P=0\)</span>.</p>
<section id="modifying-the-restart-file">
<h3>Modifying the RESTART file<a class="headerlink" href="#modifying-the-restart-file" title="Permalink to this heading">¶</a></h3>
<p>Firstly, you can use the RESTART file directly, modifying it so that
instead of continuing with the original <em>NVT</em> simulation it will instead
start a new <em>NPT</em> simulation. We have included in the “tutorial-2”
directory both a RESTART file from tutorial 1 and an adjusted file which
will run <em>NPT</em> dynamics, “tutorial-2a.xml”</p>
<p>These adjustments start with resetting the “step” tag, so that it starts
with the value 0. This can be done by simply removing the tag.
Similarly, we can increase the total number of steps so that it is more
suitable for collecting the necessary amount of <em>NPT</em> data, in this case
we will set “total_steps” to 100000.</p>
<p>We will also update the output files, first by setting the filenames to
start with “tut2a” rather than “tut1”, and secondly by adding the volume
and pressure to the list of computed properties so that we can check
that the ensemble is being sampled correctly. Putting this together
gives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">simulation</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">output</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;tut2a&#39;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">properties</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;md&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">&gt;</span>
           <span class="p">[</span> <span class="n">step</span><span class="p">,</span> <span class="n">time</span><span class="p">{</span><span class="n">picosecond</span><span class="p">},</span> <span class="n">conserved</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">temperature</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">potential</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span>
             <span class="n">kinetic_cv</span><span class="p">{</span><span class="n">kelvin</span><span class="p">},</span> <span class="n">pressure_cv</span><span class="p">{</span><span class="n">megapascal</span><span class="p">},</span> <span class="n">volume</span> <span class="p">]</span>
     <span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">properties</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;force&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">atom_f</span><span class="p">{</span><span class="n">piconewton</span><span class="p">}(</span><span class="n">atom</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">bead</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">trajectory</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;100&#39;</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span> <span class="n">cell_units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="o">&gt;</span>
             <span class="n">positions</span><span class="p">{</span><span class="n">angstrom</span><span class="p">}</span>
     <span class="o">&lt;/</span><span class="n">trajectory</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">checkpoint</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;checkpoint&#39;</span> <span class="n">stride</span><span class="o">=</span><span class="s1">&#39;1000&#39;</span> <span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="o">/&gt;</span>
   <span class="o">&lt;/</span><span class="n">output</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">total_steps</span><span class="o">&gt;</span><span class="mi">100000</span><span class="o">&lt;/</span><span class="n">total_steps</span><span class="o">&gt;</span>
  <span class="o">...</span>
 <span class="o">&lt;</span><span class="n">simulation</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally, we must change the <a class="reference internal" href="input-tags.html#ensemble"><span class="std std-ref">ensemble</span></a> and <a class="reference internal" href="input-tags.html#dynamics"><span class="std std-ref">dynamics</span></a> the tags so that the correct ensemble is
sampled. The first thing that must be done is adding a “pressure” tag in
the ensemble:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ensemble</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">pressure</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&lt;/</span><span class="n">pressure</span><span class="o">&gt;</span>
    <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">ensemble</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Then, we must also specify the constant pressure algorithm, using the
tag <a class="reference internal" href="input-tags.html#barostat"><span class="std std-ref">barostat</span></a> within the dynamics environment. Do not forget to change the mode
attribute of the dynamics from “nvt” to “npt”.
This example uses a stochastic barostat to apply pressure
to an isotropic system, which can be specified with the option “isotropic”.
See the documentation of the <a class="reference internal" href="input-tags.html#barostat"><span class="std std-ref">barostat</span></a> object and the examples to see how to apply
an anisotropic stress, or to allow for cell shape fluctuations.</p>
<p>The isotropic barostat also requires a thermostat to deal with the
volume degree of freedom, which we will take to be a simple Langevin
thermostat. This thermostat is specified in the same way as the one
which does the constant temperature algorithms for the atomic degrees of
freedom, and we will take its time scale to be 250 femtoseconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;system&gt;
  ...
  &lt;ensemble&gt;
     &lt;pressure&gt; 0 &lt;/pressure&gt;
  &lt;/ensemble&gt;
  &lt;motion mode=’dynamics’&gt;
     &lt;dynamics mode=’npt’&gt;
         &lt;barostat mode=’isotropic’&gt;
              &lt;thermostat mode=’langevin’&gt;
                 &lt;tau units=’femtosecond’&gt; 250 &lt;/tau&gt;
              &lt;/thermostat&gt;
          &lt;/barostat&gt;
          ...
     &lt;/dynamics&gt;
     ...
   &lt;/motion&gt;
&lt;/system&gt;
</pre></div>
</div>
<p>Finally, we will take the barostat time scale to be 250 femtoseconds
also, giving:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;system&gt;
  ...
  &lt;ensemble&gt;
     &lt;pressure&gt; 0 &lt;/pressure&gt;
  &lt;/ensemble&gt;
  &lt;motion mode=’dynamics’&gt;
     &lt;dynamics mode=’npt’&gt;
         &lt;barostat mode=’isotropic’&gt;
              &lt;thermostat mode=’langevin’&gt;
                 &lt;tau units=’femtosecond’&gt; 250 &lt;/tau&gt;
              &lt;/thermostat&gt;
              &lt;tau units=&#39;femtosecond&#39;&gt; 250 &lt;/tau&gt;
          &lt;/barostat&gt;
          ...
     &lt;/dynamics&gt;
     ...
   &lt;/motion&gt;
&lt;/system&gt;
</pre></div>
</div>
<p>with the rest of the <a class="reference internal" href="input-tags.html#ensemble"><span class="std std-ref">ensemble</span></a> and <a class="reference internal" href="input-tags.html#dynamics"><span class="std std-ref">dynamics</span></a> tags being the same as before.
Note that in a <em>NPT</em> simulation, we have two thermostats, one applied to the nuclear degrees of freedom and one
applied to the volume degrees of freedom.</p>
</section>
<section id="initialization-from-restart">
<h3>Initialization from RESTART<a class="headerlink" href="#initialization-from-restart" title="Permalink to this heading">¶</a></h3>
<p>A different way of initializing the simulation is to use the RESTART
file as a configuration file, in the same way that the xyz/pdb files
were used previously.</p>
<p>Firstly, the original input file “tutorial-1.xml” needs to be modified
so that it will do a <em>NPT</em> simulation instead of <em>NVT</em>. This involves
modifying the “total_steps” <a class="reference internal" href="input-tags.html#output"><span class="std std-ref">output</span></a> and <a class="reference internal" href="input-tags.html#ensemble"><span class="std std-ref">ensemble</span></a> tags as above.
Next, we replace the tag <a class="reference internal" href="input-tags.html#initialize"><span class="std std-ref">initialize</span></a> section with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">initialize</span> <span class="n">nbeads</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">file</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;chk&#39;</span><span class="o">&gt;</span> <span class="n">tutorial</span><span class="o">-</span><span class="mi">1</span><span class="n">_RESTART</span> <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">initialize</span><span class="o">&gt;</span>
  <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that the “mode” attribute has been set to “chk” to specify that the
file is a checkpoint file. This will then use the RESTART file to
initialize the bead configurations and velocities and the cell
parameters.</p>
<p>Again, there is a file in the “tutorial-2” directory for this purpose,
“tutorial-2b.xml”.</p>
</section>
<section id="id6">
<h3>Running the simulation<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<p>Whichever method is used to create the input file, the simulation is run
in the same way as before, using either “tutorial-2a.xml” or
“tutorial-2b.xml” as the input file. Note how the volume fluctuates with
time, as it is no longer held constant in this ensemble.</p>
</section>
</section>
<section id="part-3-a-fully-converged-simulation">
<h2>Part 3 - A fully converged simulation<a class="headerlink" href="#part-3-a-fully-converged-simulation" title="Permalink to this heading">¶</a></h2>
<p>As a final example, we note that at this state point 16 replicas and at
least 172 particles are actually required to provide converged results.
As a last tutorial then, you should repeat tutorials 1 and 2 with this
number of replicas and atoms.</p>
<p>The directory “tutorial-3” contains <em>NVT</em> and <em>NPT</em> input files which
can be used to do a fully converged <em>NPT</em> simulation from scratch,
except that they are missing some of the necessary input parameters.</p>
<p>If these are chosen correctly and the simulation is run properly the
volume will be 31 <span class="math notranslate nohighlight">\(\textrm{cm}^3\)</span>/mol and the total energy should
be -48 K <span id="id7">[<a class="reference internal" href="bibliography.html#id769"><span>MHT99</span></a>]</span>.</p>
<p>With this number of beads and atoms, the force calculation is likely to
take much longer than it did in either tutorial 1 or 2. To help speed
this up, we will now discuss how to parallelize the calculation over the
sockets, and how to speed up the data transfer.</p>
<p>Firstly, in this simple case where we are calculating an isotropic,
pair-wise interaction, the data transfer time is likely to be a
significant proportion of the total calculation time. To help speed this
up, there is the option to use a unix domain socket rather than an
internet socket. These are optimized for local communication between
processes on a single computer, and so for the current problem they will
be much faster than internet sockets.</p>
<p>To specify this, we simply set the “mode” attribute of the <a class="reference internal" href="input-tags.html#ffsocket"><span class="std std-ref">ffsocket</span></a> tag
to “unix”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;ffsocket mode=’unix’ name=&quot;driver&quot;&gt; ... &lt;/ffsocket&gt;
</pre></div>
</div>
<p>We then specify that the client code should connect to a unix socket
using the -u flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">i</span><span class="o">-</span><span class="n">pi</span><span class="o">-</span><span class="n">driver</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">m</span> <span class="n">sg</span> <span class="o">-</span><span class="n">a</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">o</span> <span class="mi">15</span> <span class="o">-</span><span class="n">p</span> <span class="mi">31415</span>
</pre></div>
</div>
<p>Parallelizing the force calculation over the different replicas of the
system is similarly easy, all that is required is to run the above
command multiple times. For example, if we wish to run 4 client codes,
we would use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">;</span> <span class="n">do</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">-</span><span class="n">pi</span><span class="o">-</span><span class="n">driver</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">m</span> <span class="n">sg</span> <span class="o">-</span><span class="n">a</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">o</span> <span class="mi">15</span> <span class="o">-</span><span class="n">p</span>
<span class="mi">31415</span> <span class="o">&amp;</span> <span class="o">&gt;</span> <span class="n">done</span>
</pre></div>
</div>
<p>Using these techniques should help speed up the calculation
considerably, at least in this simple case. Note however, that using
unix domain sockets would give a negligible gain in speed in most
simulations, since the force calculation usually takes much longer than
the data transfer.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="onlinereso.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Tutorials, recipes, and on-line resources</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="distributed.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Distributed execution</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021, The i-PI developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">A simple tutorial</a><ul>
<li><a class="reference internal" href="#part-1-nvt-equilibration-run">Part 1 - <em>NVT</em> Equilibration run</a><ul>
<li><a class="reference internal" href="#creating-the-xml-input-file">Creating the xml input file</a><ul>
<li><a class="reference internal" href="#initializing-the-configurations">Initializing the configurations</a></li>
<li><a class="reference internal" href="#a-further-comment-on-the-cell-units-and-parameters">A further comment on the cell units and  parameters</a></li>
<li><a class="reference internal" href="#generating-the-correct-dynamics">Generating the correct dynamics</a></li>
<li><a class="reference internal" href="#defining-the-forces">Defining the forces</a></li>
<li><a class="reference internal" href="#creating-the-server-socket">Creating the server socket</a></li>
<li><a class="reference internal" href="#customizing-the-output">Customizing the output</a></li>
<li><a class="reference internal" href="#input-file-tutorial-1">Input file tutorial-1</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-simulation">Running the simulation</a></li>
<li><a class="reference internal" href="#output-data">Output data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#part-2-npt-simulation">Part 2 - <em>NPT</em> simulation</a><ul>
<li><a class="reference internal" href="#modifying-the-restart-file">Modifying the RESTART file</a></li>
<li><a class="reference internal" href="#initialization-from-restart">Initialization from RESTART</a></li>
<li><a class="reference internal" href="#id6">Running the simulation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#part-3-a-fully-converged-simulation">Part 3 - A fully converged simulation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b869d6ab"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>